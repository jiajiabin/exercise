import requestbook
import re
from write import WhiteIntxt

class BookInfo(requestbook.RequestDelegate):
    def __init__(self):
        self.__request = requestbook.RequestBook(self)
        self.__whitetxt = None
    def receive_data(self, data):
        self.analyze_data(data)
    def download(self,url):
        self.__request.request(url)
    def analyze_data(self,data):
        self.__whitetxt = WhiteIntxt()
        # 获取章节名
        pattern1 = '<title> (.*)_超神制卡师_玄幻小说_笔趣阁</title>'
        ret1 = re.search(pattern1, data, re.S)
        self.__whitetxt.set_title(ret1.group(1))
        # 获取章节内容
        pattern1 = '<div id="content">&nbsp;&nbsp;&nbsp;&nbsp;(.*)&nbsp;&nbsp;&nbsp;&nbsp;'
        ret1 = re.search(pattern1, data, re.S)
        list1 = ret1.group(1).split("<br />")
        for i in list1:
            if "&nbsp" in i:
                list2 = i.split("&nbsp;")
                i = list2[-1]
            if '\n' in i:
                pass
            else:
                self.__whitetxt.set_content(i)
        self.__whitetxt.white()
    def end(self):
        self.__whitetxt.end()


path = "https://www.biquga.com/51_51749/%s.html"
a = [ '23341096', '23343887', '23351526', '23359750', '23359751', '23361537', '23366267', '23368017', '23375332', '23377611', '23382144', '23384007', '23389375', '23396152', '23405317', '23405318', '23410017', '23411231', '23415744', '23417171', '23421825', '23428454', '23432540', '23437182', '23438600', '23443634', '23444712', '23450178', '23451574', '23462301', '23462302', '23462304', '23467942', '23467943', '23473689', '23478889', '23480275', '23484816', '23491381', '23497180', '23512261', '23512262', '23520200', '23528876', '23534893', '23540786', '23546616', '23551731', '23557478', '23563211', '23568861', '23574399', '23579498', '23593472', '23593473', '23593474', '23598868', '23606480', '23613219', '23618945', '23624165', '23629382', '23635901', '23641188', '23646642', '23657096', '23664904', '23674836', '23679887', '23685721', '23697838', '23697839', '23710991', '23731071', '23737421', '23745579', '23745580', '23745581', '23757428', '23763889', '23767490', '24151770', '24679610', '25169257', '25478116', '25596789', '25678371', '25766484', '25801864', '25856395', '25896324', '25967294', '25967297', '26007655', '26042411', '26062203', '26082945', '26082946', '26098794', '26109228', '26120355', '26128702', '26277593', '26277594', '26345464', '26403476', '26423036', '26441913', '26451236', '26461764', '26496753', '26496754', '26496755', '26496756', '26508212', '26518275', '26524896', '26540943', '26633000', '26633002', '26633004', '26633006', '26633008', '26633010', '26633014', '26633016', '26633017', '26633018', '26633019', '26633020', '26633021', '26633022', '26633023', '26633024', '26712255', '26733046', '26747189', '26760940', '26760942', '26783773', '26792323', '26799662', '26806907', '26813803', '26821551', '26828224', '26834351', '26843967', '26850082', '26866734', '26866743', '26874287', '26882667', '26891410', '26912928', '26922516', '26928840', '26935290', '26948713', '26954136', '26960230', '26973541', '26988239', '26994192', '27001931', '27010851', '27018680', '27025101', '27032170', '27038091', '27044510', '27051370', '27057246', '27062428', '27066824', '27081351', '27081352', '27085979', '27089584', '27092954', '27097269', '27101557', '27101985', '27105161', '27109526']
mim = BookInfo()
for i in a:
    try:
        mim.download(path % i)
    except AttributeError as e:
        print(e)
mim.end()